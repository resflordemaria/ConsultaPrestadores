<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prestadores Flor de Maria</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { color: #333; margin-bottom: 4px; }
    label, select, #status { margin-top: 10px; display: block; }
    #status { font-style: italic; color: #555; margin: 12px 0 4px; }

    /* Blocos por categoria */
    .categoria-bloco { margin-top: 28px; }
    .categoria-titulo {
      background: #e8e8e8;
      border: 1px solid #d5d5d5;
      border-radius: 8px;
      padding: 10px 12px;
      font-weight: bold;
    }

    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: white; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f3f3f3; }
    a { text-decoration: none; }
  </style>
</head>
<body>
  <h1>Prestadores Flor de Maria</h1>

  <label for="categoria">Filtrar por tipo de profissional:</label>
  <select id="categoria" onchange="filtrarDados()">
    <option value="">-- Todas as categorias --</option>
  </select>

  <div id="status">Carregando dados...</div>

  <div id="resultados"></div>

  <!-- PapaParse para leitura robusta de CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTr4FxiY5aB2DdJ_bQfxg-ZRwud8xTsK_W2M8a2lnk6xtRd1854GH7nmRQM2tiWICBqIi6za3eKxDuZ/pub?gid=0&single=true&output=csv';

    // dados normalizados = { nome, telefone, categoria }
    let dados = [];
    let categoriasOrdenadas = [];

    // Detecta colunas (case-insensitive)
    function detectarCampos(headers) {
      const map = {};
      headers.forEach(h => {
        const k = h.trim().toLowerCase();
        if (k.includes('nome') && !map.nome) map.nome = h;
        if ((k.includes('tel') || k.includes('fone')) && !map.telefone) map.telefone = h;
        if (k.includes('categoria') && !map.categoria) map.categoria = h;
      });
      return map;
    }

    function normalizarNumeroParaZap(t) {
      if (!t) return '';
      let d = String(t).replace(/\D/g, ''); // só dígitos

      // já começa com 55? então ok
      if (d.startsWith('55')) return d;

      // tem DDD? (10 fixo, 11 móvel)
      if (d.length === 10 || d.length === 11) return '55' + d;

      // só número local (8 ou 9 dígitos): assume DDD 82
      if (d.length === 8 || d.length === 9) return '5582' + d;

      // qualquer outro caso: não c
